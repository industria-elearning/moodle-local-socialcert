{"version":3,"file":"actions.min.js","sources":["../src/actions.js"],"sourcesContent":["// amd/src/actions.js\n\n/**\n * Mapa de acciones: nombre -> handler(ev, el)\n * @type {Map<string, Function>}\n */\nconst registry = new Map();\n\n/**\n * Delegaci√≥n de eventos: escucha en `root` y, si el objetivo o un ancestro\n * coincide con `selector`, ejecuta `handler(ev, targetMatch)`.\n * @param {HTMLElement} root     Contenedor ra√≠z donde delegar\n * @param {string} selector      Selector a matchear (con closest)\n * @param {string} type          Tipo de evento (p.ej., 'click')\n * @param {(ev:Event, el:HTMLElement)=>void} handler  Manejador\n * @returns {void}\n */\nfunction on(root, selector, type, handler) {\n  root.addEventListener(type, (ev) => {\n    const target = ev.target.closest(selector);\n    if (!target || !root.contains(target)) {\n      return;\n    }\n    handler(ev, target);\n  });\n}\n\n/**\n * Muestra/oculta nodos seg√∫n el estado actual de red en `root.dataset.network`.\n * Cada bloque sensible debe declarar `data-visible-on=\"linkedin twitter ...\"`\n * @param {HTMLElement} root  Contenedor ra√≠z con data-network\n * @returns {void}\n */\nfunction updateVisibility(root) {\n  const current = root.dataset.network || '';\n  root.querySelectorAll('[data-visible-on]').forEach(el => {\n    const allowed = (el.getAttribute('data-visible-on') || '').split(/\\s+/);\n    if (allowed.includes(current)) {\n      el.classList.remove('d-none');\n    } else {\n      el.classList.add('d-none');\n    }\n  });\n}\n\n/**\n * Selecciona pesta√±a/red (data-network), actualiza aria-selected y visibilidad.\n * @param {MouseEvent} ev\n * @param {HTMLElement} el  Bot√≥n con data-network=\"...\"\n * @returns {void}\n */\nexport function handleSelectNetwork(ev, el) {\n  ev.preventDefault();\n  const root = el.closest('.local-socialcert');\n  if (!root) {\n    return;\n  }\n\n  const next = el.dataset.network;\n  if (!next) {\n    return;\n  }\n\n  // Estado\n  root.dataset.network = next;\n\n  // Toggle visual en el grupo\n  const group = el.closest('.lsc-social-tabs');\n  if (group) {\n    group.querySelectorAll('[data-action=\"select-network\"]').forEach(b => {\n      b.classList.toggle('active', b === el);\n      b.setAttribute('aria-selected', b === el ? 'true' : 'false');\n    });\n  }\n\n  // Mostrar/ocultar secciones\n  updateVisibility(root);\n}\n\n/**\n * Abre un enlace en nueva pesta√±a. Usa href o data-url.\n * Marca aria-busy brevemente como feedback.\n * @param {MouseEvent} ev\n * @param {HTMLElement} el\n * @returns {void}\n */\nfunction handleOpenLink(ev, el) {\n  // Si es <a> con href, dejamos que el browser lo haga,\n  // pero a√±adimos un peque√±o ‚Äúbusy‚Äù/tracking si quieres.\n  // Si NO quieres prevenir, comenta la l√≠nea de preventDefault.\n  ev.preventDefault();\n\n  el.setAttribute('aria-busy', 'true');\n  // Si el elemento no tiene href (ej. <button>), abrimos data-url:\n  const url = el.getAttribute('href') || el.dataset.url;\n  if (url) {\n    window.open(url, '_blank', 'noopener');\n  }\n  // Quita busy luego de un tick\n  setTimeout(() => el.removeAttribute('aria-busy'), 300);\n}\n\n/**\n * Copia el HTML interno del selector dado en data-target.\n * @param {MouseEvent} _ev\n * @param {HTMLElement} el\n * @returns {void}\n */\nfunction handleCopyHtml(_ev, el) {\n  const sel = el.dataset.target || '';\n  const node = sel ? document.querySelector(sel) : null;\n  if (!node) {\n    return;\n  }\n  // Copia HTML\n  const html = node.innerHTML;\n  navigator.clipboard.writeText(html).catch(() => { /* fallback opcional */ });\n}\n\n/**\n * Copia la URL src de la imagen indicada en data-target.\n * @param {MouseEvent} _ev\n * @param {HTMLElement} el\n * @returns {void}\n */\nfunction handleCopyImage(_ev, el) {\n  const sel = el.dataset.target || '';\n  const img = sel ? document.querySelector(sel) : null;\n  if (!img) {\n    return;\n  }\n  // Copiar URL de imagen (sencillo y compatible)\n  const src = img.getAttribute('src');\n  if (src) {\n    navigator.clipboard.writeText(src);\n  }\n}\n\n/**\n * Registra una acci√≥n para usar con data-action=\"name\".\n * @param {string} name\n * @param {(ev:Event, el:HTMLElement)=>void} fn\n * @returns {void}\n */\nexport function register(name, fn) { registry.set(name, fn); }\n\n/**\n * Punto de entrada: registra handlers base y activa la delegaci√≥n de clicks.\n * @returns {void}\n */\nexport function init() {\n  const root = document.querySelector('.local-socialcert');\n  if (!root) {\n    return;\n  }\n\n  // ‚¨áÔ∏è FALTABA registrar el selector de red\n  register('select-network', handleSelectNetwork);\n  updateVisibility(root);\n\n  // Registra acciones base\n  register('open-link', handleOpenLink);\n  register('copy-html', handleCopyHtml);\n  register('copy-image', handleCopyImage);\n  register('run-ai', runAiHandler);\n\n  // Delegaci√≥n √∫nica para todos los clicks con data-action\n  on(root, '[data-action]', 'click', (ev, el) => {\n    const action = el.dataset.action;\n    const fn = registry.get(action);\n    if (fn) {\n      fn(ev, el);\n    }\n  });\n\n  // ‚¨áÔ∏è Calcula visibilidad inicial seg√∫n data-network del root\n  updateVisibility(root);\n}\n\n// --- STREAM MOCK + TYPEWRITER -----------------------------------------------\n\n/**\n * Inserta y devuelve un cursor visual (caret) al final del elemento destino.\n * Se usa para simular escritura en vivo.\n *\n * @param {HTMLElement} el - Contenedor donde se a√±adir√° el caret.\n * @returns {HTMLSpanElement} caret - El nodo <span> insertado con la clase \"lsc-caret\".\n */\nfunction addCaret(el) {\n  const caret = document.createElement('span');\n  caret.className = 'lsc-caret';\n  caret.textContent = ' ';\n  el.appendChild(caret);\n  return caret;\n}\n\n/**\n * Elimina, si existe, el cursor visual (caret) dentro del elemento destino.\n *\n * @param {HTMLElement} el - Contenedor desde el que se eliminar√° el caret.\n * @returns {void}\n */\nfunction removeCaret(el) {\n  const caret = el.querySelector('.lsc-caret');\n  if (caret) { caret.remove(); }\n}\n\n// Control de streams por destino (para detener si se pulsa de nuevo)\nconst streams = new WeakMap();\n\n/**\n * Escribe texto en unidades (char|word) con un intervalo.\n * @param {HTMLElement} el\n * @param {string} text\n * @param {'char'|'word'} mode\n * @param {number} speedMs\n * @returns {{stop:Function, done:Promise<void>}}\n */\nexport function typewriter(el, text, mode, speedMs) {\n  const caret = addCaret(el);\n  const units = mode === 'char' ? text.split('') : text.split(/\\s+/);\n  let i = 0;\n  let stopped = false;\n  el.innerHTML = '';\n  el.appendChild(caret);\n\n  const done = new Promise((resolve) => {\n    const timer = setInterval(() => {\n      if (stopped) {\n        clearInterval(timer);\n        removeCaret(el);\n        resolve();\n        return;\n      }\n      if (i >= units.length) {\n        clearInterval(timer);\n        removeCaret(el);\n        resolve();\n        return;\n      }\n      const chunk = units[i++];\n      caret.insertAdjacentText('beforebegin', mode === 'word' ? (chunk + ' ') : chunk);\n    }, Math.max(10, speedMs || 30));\n    streams.set(el, { stop: () => { stopped = true; } });\n  });\n\n  return { stop() { const s = streams.get(el); if (s) { s.stop(); streams.delete(el); } }, done };\n}\n\n/** MOCK: sustituye luego por tu fetch real */\nfunction fetchAiMock() {\n  const demo = \"¬°Hola! Esta es una respuesta de ejemplo generada por IA. \" +\n               \"Se muestra poco a poco para simular streaming y que la \" +\n               \"experiencia se sienta m√°s natural üôÇ.\";\n  return Promise.resolve(demo);\n}\n\n/**\n * Ejecuta/Detiene la ‚ÄúIA‚Äù (streaming).\n * Lee data-target, data-mode (\"char\"|\"word\"), data-speed (ms).\n * @param {MouseEvent} ev\n * @param {HTMLElement} btn\n */\nexport function runAiHandler(ev, btn) {\n  ev.preventDefault();\n\n  // Localiza el destino\n  const sel = btn.dataset.target;\n  let target = null;\n  if (sel) {\n    target = document.querySelector(sel);\n  } else {\n    const wrap = btn.closest('.lsc-response-wrap');\n    target = wrap ? wrap.querySelector('.lsc-response') : null;\n  }\n  if (!target) { return; }\n\n  // Si ya hay stream en ese destino: detener y restaurar\n  if (streams.has(target)) {\n    const s = streams.get(target);\n    if (s && s.stop) { s.stop(); }\n    btn.disabled = false;\n    btn.textContent = 'Activar IA';\n    return;\n  }\n\n  // Preparar UI\n  const mode = (btn.dataset.mode === 'char') ? 'char' : 'word';\n  const speed = parseInt(btn.dataset.speed || '40', 10);\n  const original = btn.textContent;\n  btn.disabled = true;\n  btn.textContent = 'Generando‚Ä¶';\n  target.setAttribute('aria-busy', 'true');\n  target.setAttribute('role', 'status');\n\n  // Mock de respuesta (sustituye luego por tu fetch real)\n  fetchAiMock().then((fulltext) => {\n    const stream = typewriter(target, fulltext, mode, speed);\n    stream.done.then(() => {\n      btn.disabled = false;\n      btn.textContent = original;\n      target.removeAttribute('aria-busy');\n      streams.delete(target);\n    });\n  }).catch(() => {\n    btn.disabled = false;\n    btn.textContent = original;\n    target.removeAttribute('aria-busy');\n  });\n}\n\n"],"names":["root","document","querySelector","register","handleSelectNetwork","updateVisibility","handleOpenLink","handleCopyHtml","handleCopyImage","runAiHandler","selector","type","handler","addEventListener","ev","target","closest","contains","on","el","action","dataset","fn","registry","get","Map","current","network","querySelectorAll","forEach","getAttribute","split","includes","classList","remove","add","preventDefault","next","group","b","toggle","setAttribute","url","window","open","setTimeout","removeAttribute","_ev","sel","node","html","innerHTML","navigator","clipboard","writeText","catch","img","src","name","set","removeCaret","caret","streams","WeakMap","typewriter","text","mode","speedMs","createElement","className","textContent","appendChild","addCaret","units","i","stopped","stop","s","delete","done","Promise","resolve","timer","setInterval","clearInterval","length","chunk","insertAdjacentText","Math","max","btn","wrap","has","disabled","speed","parseInt","original","then","fulltext"],"mappings":"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"}