define("local_socialcert/actions",["exports","core/str"],(function(_exports,_str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleCopyText=handleCopyText,_exports.handleSelectNetwork=handleSelectNetwork,_exports.init=function(){const root=document.querySelector(".local-socialcert");if(!root)return;register("select-network",handleSelectNetwork),updateVisibility(root),register("open-link",handleOpenLink),register("copy-html",handleCopyHtml),register("copy-image",handleCopyImage),register("run-ai",runAiHandler),register("copy-text",handleCopyText),register("download-image",handleDownloadImage),on(root,"[data-action]","click",((ev,el)=>{const action=el.dataset.action,fn=registry.get(action);fn&&fn(ev,el)})),on(root,'[data-action="copy-text"]',"keydown",((ev,el)=>handleCopyText(ev,el))),updateVisibility(root)},_exports.register=register,_exports.runAiHandler=runAiHandler,_exports.typewriter=typewriter;const registry=new Map;function on(root,selector,type,handler){root.addEventListener(type,(ev=>{const target=(ev.target instanceof Element?ev.target:root).closest(selector);target&&root.contains(target)&&handler(ev,target)}))}function updateVisibility(root){const current=root.dataset.network||"";root.querySelectorAll("[data-visible-on]").forEach((el=>{(el.getAttribute("data-visible-on")||"").split(/\s+/).includes(current)?el.classList.remove("d-none"):el.classList.add("d-none")}))}function handleSelectNetwork(ev,el){ev.preventDefault();const root=el.closest(".local-socialcert");if(!root)return;const next=el.dataset.network;if(!next)return;root.dataset.network=next;const group=el.closest(".lsc-social-tabs");group&&group.querySelectorAll('[data-action="select-network"]').forEach((b=>{b.classList.toggle("active",b===el),b.setAttribute("aria-selected",b===el?"true":"false")})),updateVisibility(root)}function handleOpenLink(ev,el){ev.preventDefault(),el.setAttribute("aria-busy","true");const url=el.getAttribute("href")||el.dataset.url;url&&window.open(url,"_blank","noopener"),setTimeout((()=>el.removeAttribute("aria-busy")),300)}async function handleCopyHtml(_ev,el){const sel=el.dataset.target||"",node=sel?document.querySelector(sel):null;if(!node)return;const clone=node.cloneNode(!0);clone.querySelectorAll(".lsc-caret").forEach((c=>c.remove()));const content="html"===("html"===el.dataset.copy?"html":"text")?clone.innerHTML:clone.innerText||clone.textContent||"";navigator.clipboard.writeText(content).then((()=>{const original=el.textContent;el.textContent="Copiado âœ”",setTimeout((()=>{el.textContent=original}),1200)})).catch((()=>{}))}function handleCopyImage(_ev,el){const sel=el.dataset.target||"",img=sel?document.querySelector(sel):null;if(!img)return;const src=img.getAttribute("src");src&&navigator.clipboard.writeText(src)}function removeCaret(el){const caret=el.querySelector(".lsc-caret");caret&&caret.remove()}const streams=new WeakMap;function typewriter(el,text,mode,speedMs){const caret=function(el){const caret=document.createElement("span");return caret.className="lsc-caret",caret.textContent=" ",el.appendChild(caret),caret}(el),units="char"===mode?text.split(""):text.split(/\s+/);let i=0,stopped=!1;el.innerHTML="",el.appendChild(caret);return{stop(){const s=streams.get(el);s&&(s.stop(),streams.delete(el))},done:new Promise((resolve=>{const timer=setInterval((()=>{if(stopped)return clearInterval(timer),removeCaret(el),void resolve();if(i>=units.length)return clearInterval(timer),removeCaret(el),void resolve();const chunk=units[i++];caret.insertAdjacentText("beforebegin","word"===mode?chunk+" ":chunk)}),Math.max(10,speedMs||30));streams.set(el,{stop:()=>{stopped=!0}})}))}}function runAiHandler(ev,btn){ev.preventDefault();const sel=btn.dataset.target;let target=null;if(sel)target=document.querySelector(sel);else{const wrap=btn.closest(".lsc-response-wrap");target=wrap?wrap.querySelector(".lsc-response"):null}if(!target)return;if(streams.has(target)){const s=streams.get(target);return s&&s.stop&&s.stop(),btn.disabled=!1,void(btn.textContent=(0,_str.get_string)("airesponsebtn","local_socialcert"))}const mode="char"===btn.dataset.mode?"char":"word",speed=parseInt(btn.dataset.speed||"40",10),original=btn.textContent;btn.disabled=!0,btn.textContent="Generating",target.setAttribute("aria-busy","true"),target.setAttribute("role","status"),Promise.resolve("Lorem ipsum dolor sit amet consectetur adipiscing elit vel curae id, mauris vivamus vulputate condimentum erat arcu ligula tristique tincidunt iaculis, ac tempor tortor suspendisse torquent nisl commodo eget mus. Nulla penatibus nostra inceptos tortor congue quam mollis ornare class, dui nunc iaculis bibendum nascetur himenaeos facilisi rhoncus, morbi nibh arcu ullamcorper faucibus dictumst facilisis tristique. Taciti lacus maecenas vulputate vel nostra ante interdum vivamus enim, est malesuada volutpat semper quisque etiam rhoncus lectus proin, quis sem vitae leo consequat euismod vestibulum facilisi. ðŸ™‚.").then((fulltext=>{typewriter(target,fulltext,mode,speed).done.then((()=>{btn.disabled=!1,btn.textContent=original,target.removeAttribute("aria-busy"),streams.delete(target)}))})).catch((()=>{btn.disabled=!1,btn.textContent=original,target.removeAttribute("aria-busy")}))}function handleCopyText(ev,el){if("keydown"===ev.type){const code=ev.key||ev.code;if("Enter"!==code&&" "!==code&&"Spacebar"!==code)return;ev.preventDefault()}let value=el.getAttribute("data-copy-value");if(!value){const clone=el.cloneNode(!0),btn=clone.querySelector(".lsc-copybtn");btn&&btn.remove(),value=clone.innerText||clone.textContent||""}navigator.clipboard.writeText(value).then((function(){let badge=el.querySelector(".lsc-copybtn");if(!badge)return;const original=badge.textContent;badge.textContent="âœ”",setTimeout((function(){badge.textContent=original}),900)})).catch((function(){}))}function register(name,fn){registry.set(name,fn)}function handleDownloadImage(_ev,el){let url=el.getAttribute("data-url")||"";if(!url){const sel=el.getAttribute("data-target")||"",img=sel?document.querySelector(sel):null;img&&(url=img.getAttribute("src")||"")}if(!url)return;try{const u=new URL(url,window.location.origin);-1===u.pathname.indexOf("/pluginfile.php")||u.searchParams.has("forcedownload")||(u.searchParams.set("forcedownload","1"),url=u.toString())}catch(_e){}const filename=el.getAttribute("data-filename")||function(){try{const base=new URL(url,window.location.origin).pathname.split("/").pop()||"certificado";return-1===base.indexOf(".")?base+".png":base}catch(_e){return"certificado.png"}}();fetch(url,{credentials:"same-origin"}).then((function(res){if(!res.ok)throw new Error("HTTP "+res.status);return res.blob()})).then((function(blob){const blobUrl=URL.createObjectURL(blob),a=document.createElement("a");a.href=blobUrl,a.download=filename,document.body.appendChild(a),a.click(),a.remove(),setTimeout((function(){URL.revokeObjectURL(blobUrl)}),500)})).catch((function(){const a=document.createElement("a");a.href=url,a.target="_blank",a.rel="noopener",a.download=filename,document.body.appendChild(a),a.click(),a.remove()}))}}));

//# sourceMappingURL=actions.min.js.map